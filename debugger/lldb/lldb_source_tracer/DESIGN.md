# LLDB Source Tracer 设计文档

## 概述
LLDB Source Tracer 是一个增强的执行跟踪工具，提供：
- 函数调用跟踪
- 参数和返回值记录
- 调用图生成
- 交互式HTML报告
- 独立的React前端查看器

## 架构设计

### 后端组件
1. **调试器接口层**：使用LLDB Python API控制调试会话
2. **事件处理器**：处理断点命中、步进等调试事件
3. **数据收集器**：
   - 函数调用栈跟踪
   - 参数/返回值捕获
   - 局部变量记录
   - 执行时间统计
4. **报告生成器**：
   - 文本日志
   - Mermaid格式调用图
   - HTML报告
   - JSON数据导出

### 前端架构
Trace Viewer 是一个基于React的Web应用，主要组件包括：

1. **数据加载器**：解析和验证JSON跟踪数据
2. **时间线侧边栏**：显示执行事件的时序视图
3. **源代码查看器**：高亮显示当前执行位置的源代码
4. **调用图可视化**：使用React Flow渲染函数调用关系
5. **性能图表**：使用Recharts展示函数执行时间统计

前端关键技术：
- React 18 (函数组件和Hooks)
- Vite构建工具
- React Flow (可视化库)
- Recharts (图表库)

## 启动系统
### 新增启动脚本
项目添加了便捷的启动脚本 `start_viewer.sh`，提供以下功能：
1. 自动进入 trace-viewer 目录
2. 启动开发服务器
3. 打开浏览器访问 http://localhost:5173

### 启动选项
提供三种启动方式：
1. **开发模式**（实时热更新）：
   ```bash
   ./start_viewer.sh  # 或 npm run dev
   ```
   
2. **生产预览模式**：
   ```bash
   npm run build
   npm run preview
   ```
   
3. **直接启动**：
   ```bash
   npm start
   ```

## 数据流
1. LLDB调试器执行目标程序并收集跟踪数据
2. 生成JSON格式的跟踪文件（包含执行日志、函数信息、源代码等）
3. Trace Viewer加载JSON文件并解析为内部数据结构
4. 用户通过交互界面探索执行轨迹

## 前端设计原则
1. **响应式布局**：适应不同屏幕尺寸
2. **增量渲染**：高效处理大型跟踪数据
3. **交互反馈**：实时响应操作
4. **错误恢复**：优雅处理异常数据
5. **模块化**：组件独立开发测试